<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>{{string.logo}}</title>
    <link rel="shortcut icon" href="{{root}}/favicon.ico" />

    <link id="bootstrap" href="{{root}}{{libs.bootstrap}}" rel="stylesheet" type="text/css" media="all" />
    {{>theme}}

    {{#libs.external.css}}
    <link href="{{.}}" rel="stylesheet" type="text/css" media="all" />
    {{/libs.external.css}}

    {{#libs.css}}
    <link href="{{root}}{{.}}" rel="stylesheet" type="text/css" media="all" />
    {{/libs.css}}

    {{#libs.external.js}}
    <script src="{{.}}" type="text/javascript" charset="utf-8"></script>
    {{/libs.external.js}}

    {{#libs.js}}
    <script src="{{root}}{{.}}" type="text/javascript" charset="utf-8"></script>
    {{/libs.js}}

    <script>
          JSONEditor.defaults.options["theme"] = "bootstrap3";
          JSONEditor.defaults.options["iconlib"] = "bootstrap3";
          JSONEditor.defaults.options["object_layout"] = "grid";
          JSONEditor.defaults.options["template"] = "default";
          JSONEditor.defaults.options["show_errors"] = "interaction";
          JSONEditor.defaults.options["required_by_default"] = 1;
          JSONEditor.defaults.options["no_additional_properties"] = 1;
          JSONEditor.defaults.options["display_required_only"] = 0;
          JSONEditor.defaults.options["remove_empty_properties"] = 0;
          JSONEditor.defaults.options["keep_oneof_values"] = 1;
          JSONEditor.defaults.options["ajax"] = 1;
          JSONEditor.defaults.options["ajaxCredentials"] = 0;
          JSONEditor.defaults.options["show_opt_in"] = 0;
          JSONEditor.defaults.options["disable_edit_json"] = 1;
          JSONEditor.defaults.options["disable_collapse"] = 0;
          JSONEditor.defaults.options["disable_properties"] = 1;
          JSONEditor.defaults.options["disable_array_add"] = 0;
          JSONEditor.defaults.options["disable_array_reorder"] = 0;
          JSONEditor.defaults.options["disable_array_delete"] = 0;
          JSONEditor.defaults.options["enable_array_copy"] = 0;
          JSONEditor.defaults.options["array_controls_top"] = 0;
          JSONEditor.defaults.options["disable_array_delete_all_rows"] = 0;
          JSONEditor.defaults.options["disable_array_delete_last_row"] = 0;
          JSONEditor.defaults.options["prompt_before_delete"] = 1;
    </script>

</head>
<body id="express-admin" class="container">
<div id="wrapper">
    {{>header}}
    {{>layout}}

    <section id="content">
        {{>breadcrumbs}}

        {{>content}}
    </section>

    <div id="footer-push">&nbsp;</div>
</div>
<footer>
    <p><small><a href="http://novgorod.digital/" target="_blank" class="text-muted">ИТ команда Цифровой Новгород 2020 год</a></small></p>
</footer>

<script type="module">
//import HandlebarsTextbox from '/Handlebars/HandlebarsTextBox.js';
//import ObservableMixin from '/@ckeditor/ckeditor5-utils/src/observablemixin.js';
//import Plugin from '/@ckeditor/ckeditor5-core/src/plugin.js';
//import RestrictedEditingMode from '/@ckeditor/ckeditor5-restricted-editing/src/restrictededitingmode.js';
//import StandardEditingMode from '/@ckeditor/ckeditor5-restricted-editing/src/standardeditingmode.js';
</script>


<script type="text/javascript">
let jseditor = new Set()
var jse;
var jseditor1,jseditor2, jedata = {schema:{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "$ref": "widget-{{string.langid}}.json",
  "additionalProperties": false,
},
"code": "// The following lines are mandatory and readonly. You can add custom code above and below.\nif (jseditor instanceof window.JSONEditor) jseditor.destroy();\njseditor = new window.JSONEditor(document.querySelector(\"#json-editor-form\"), jedata);\n\njseditor.on('ready', function() {\n\n  var startVal = jseditor.getValue(),\n  submitButton = jseditor.root.getButton('Submit (console.log)', '', 'Submit (console.log)'),\n  restoreButton = jseditor.root.getButton('Restore to Default', '', 'Restore to Default'),\n  enableDisableButton = jseditor.root.getButton('Disable/Enable Form', '', 'Disable/Enable Form'),\n  button_holder = jseditor.root.theme.getHeaderButtonHolder();\n\n  button_holder.appendChild(submitButton);\n  button_holder.appendChild(restoreButton);\n  button_holder.appendChild(enableDisableButton);\n\n  jseditor.root.header.parentNode.insertBefore(button_holder, jseditor.root.header.nextSibling);\n\n  submitButton.addEventListener('click', function() {\n    console.log(jseditor.getValue());\n  });\n\n  restoreButton.addEventListener('click', function() {\n    jseditor.setValue(startVal);\n  });\n\n  enableDisableButton.addEventListener('click', function() {\n    if (!jseditor.isEnabled()) {\n      jseditor.enable();\n    } else {\n      jseditor.disable();\n    }\n  });\n\n});",
"style": "",
"desc": "Add optional description here. (HTML format)"
};// The following lines are mandatory and readonly. You can add custom code above and below.
if (jseditor1 instanceof window.JSONEditor) jseditor1.destroy();
if (jseditor2 instanceof window.JSONEditor) jseditor2.destroy();

if ($("#json-editor-form").length) {
    var jseditor_instance_count = $('div[id="json-editor-form"]').length;
      for (var j=0;j<jseditor_instance_count;j++) {
      var fieldname = $('div[id="json-editor-form"]')[j].classList[0].split('][').reverse()[0].replace(']','');
      var data = JSON.stringify(jedata).replace('widget-','widget-'+fieldname+'-');
      let jse = new window.JSONEditor($('div[id="json-editor-form"]')[j], JSON.parse(data));
      jseditor.add(jse);

          jse.on('ready', function() {
              var json_string = $('input[name="'+jse.element.className+'"]').attr('value');
              if (json_string.length)  {
                  jse.setValue(JSON.parse(json_string));
                } else {
                  jse.setValue(JSON.parse('[{}]'));
                }
            //    $('.required:all').addClass('hidden');
                for (var i=0;i<$('label.required').length;i++) {
                  $('label.required')[i].classList.add('hidden');
                }
                for (var i=0;i<$('h3.je-object__title').length;i++) {
                  $('h3.je-object__title')[i].classList.add('hidden');
                }
                for (var i=0;i<$('span.je-object__controls').length;i++) {
                  $('span.je-object__controls')[i].classList.add('hidden');
                }

          });
          jse.on('change',() => {
            // Do something
            var json_string = JSON.stringify(jse.getValue());
            if (json_string != "[]") $('input[name="'+jse.element.className+'"]').attr('value',json_string);
          });

    }
/*     if ($('div[id="json-editor-form"]').length >= 1) {
      var fieldname = $('div[id="json-editor-form"]')[0].classList[0].split('][').reverse()[0].replace(']','');
      var data = JSON.stringify(jedata).replace('widget-','widget-'+fieldname+'-');
      jseditor1 = new window.JSONEditor($('div[id="json-editor-form"]')[0], JSON.parse(data));

      jseditor1.on('ready', function() {
        var json_string = $('input[name="'+jseditor1.element.className+'"]').attr('value');
        if (json_string.length)  {
            jseditor1.setValue(JSON.parse(json_string));
          } else {
            jseditor1.setValue(JSON.parse('[{}]'));
          }
      //    $('.required:all').addClass('hidden');
          $('.je-header:first').addClass('hidden');
          $('.je-switcher:first').addClass('hidden');
          for (var i=0;i<$('label.required').length;i++) {
            $('label.required')[i].classList.add('hidden');
          }
      });
      jseditor1.on('change',() => {
        // Do something
        var json_string = JSON.stringify(jseditor1.getValue());
        if (json_string != "[]") $('input[name="'+jseditor1.element.className+'"]').attr('value',json_string);
      });
    }
    if ($('div[id="json-editor-form"]').length >= 2) {
      var fieldname = $('div[id="json-editor-form"]')[1].classList[0].split('][').reverse()[0].replace(']','');
      var data = JSON.stringify(jedata).replace('widget-','widget-'+fieldname+'-');
      jseditor2 = new window.JSONEditor($('div[id="json-editor-form"]')[1], JSON.parse(data));

      jseditor2.on('ready', function() {
        var json_string = $('input[name="'+jseditor2.element.className+'"]').attr('value');
        if (json_string.length)  {
            jseditor2.setValue(JSON.parse(json_string));
          } else {
            jseditor2.setValue(JSON.parse('[{}]'));
          }
          $('.je-header:first').addClass('hidden');
          $('.je-switcher:first').addClass('hidden');
          for (var i=0;i<$('label.required').length;i++) {
            $('label.required')[i].classList.add('hidden');
          }
      });
      jseditor2.on('change',() => {
        // Do something
        var json_string = JSON.stringify(jseditor2.getValue());
        if (json_string != "[]") $('input[name="'+jseditor2.element.className+'"]').attr('value',json_string);
      });
    }*/

}
</script>

<script type="text/javascript">

/*  InlineEditor
    .create( document.querySelector( '#editor' ) )
    .then( editor => {
      window.editor = editor;
    } )
    .catch( error => {
      console.error( 'There was a problem initializing the editor.', error );
    } );*/
          /*  ClassicEditor
                .create( document.querySelector( '#editor' ) )
                .catch( error => {
                    console.error( error );
                } );*/
                //import CodeBlock from '../@ckeditor/ckeditor5-code-block/src/codeblock';
                //var _code_languages = ["plain","c","cs","cpp","html","xml","css","javascript","python","sql","php","perl","ruby","markdown","auto"];



                var editors = [];
                function createEditor( elementId, data ) {
                    return CKEDITOR
                        .create( document.querySelector( elementId ),{
                            removePlugins: [ 'BlockQuote','PreElementToolbar','PreElement','RestrictedEditingMode','StandardEditingMode'],
                          //removePlugins: [ 'BlockQuote','RestrictedEditingMode','StandardEditingMode'],
                        //  toolbar: ['pre','codeBlock','|','undo','redo','|'],
                          toolbar: ['code','codeBlock','|','undo','redo','|'],

                    /*      preCodeBlock :{

                                		languages: _code_languages.map( _language => {return{
                                			language: _language,
                                			title: _language=="cs"?"c#":_language
                                		};}),
                                		toolbar: [ 'EditLanguage', '|', 'SelectLanguage' , '|', 'HighlightCodeBlock', '|', 'CloseCodeBlock'],
                                			noOfSpaceForTabKey: 4,
                                		highlightConfig:{
                                			// this function is called whenever syntax highlighting is requested.
                                			// the highlighting pre element and language will be the arguments for this function
                                			// this function should return syntax highlighted block.
                                			// below example uses highlightjs as syntax highlighter
                                			highlighter:( pre_block, language )=>{

                                				// to undo highlighting simply uncomment below two lines and return pre_block as is
                                				// or you can select plain/text/nohighlight option from language if highlighter supports
                                				pre_block.innerHTML = pre_block.innerHTML.replace(/<br[ \/]*>/gi, '\n');
                                				hljs.highlightBlock(pre_block); // refer https://github.com/highlightjs/highlight.js
                                				return pre_block; // return highlighted pre block to plugin
                                			}
                                		}
                                	},
*/
                          codeBlock: {
                                         languages: [
                                              { language: 'css', label: 'CSS' },
                                              { language: 'html', label: 'HTML' },
                                              { language: 'xml', label: 'XML' },
                                              { language: 'javascript', label: 'JavaScript' }  ]

                                            /*  languages: [
                // Do not render the CSS class for the plain text code blocks.
                { language: 'plaintext', label: 'Plain text', class: '' },

                  // Use the "js" class for JavaScript code blocks.
                // Note that only the first ("js") class will determine the language of the block when loading data.
                { language: 'javascript', label: 'JavaScript', class: 'js javascript js-code' },

                // Python code blocks will have the default "language-python" CSS class.
                { language: 'python', label: 'Python' }
            ]*/

                                      },
                          language: 'en'
                        })
                        .then( editor => {
                        editors[ elementId ] = editor;
                        if (editor.getData() == "") {
                            editor.setData( data ); // You should set editor data here
                          }
                      //  editor.setData('<code>'+editor.getData()+'</code>');
                    //    hljs.highlightBlock(editor);
                    } )
                        .catch( err => console.error( err ) );
                }

                $(document).ready( function() {
                    if (jQuery(".ck-compact").length) {createEditor( '.ck-compact', 'Содержание: \n```javascript\n . \n```\n\n Комментарий: \n Автор/источник: \n' )}
                    else {hljs.initHighlightingOnLoad()}
                  //createEditor( 'form-control', 'test' );
                });

/*
                CKEDITOR
                    .create( document.querySelector( '.ck-compact' ),{
//                      plugins: [ RestrictedEditingMode ],
                      toolbar: ['codeBlock','|','undo','redo','|'],
                      removePlugins: [ 'BlockQuote','PreElementToolbar','PreElement','RestrictedEditingMode','StandardEditingMode'],
                      codeBlock: {
                                      languages: [
                                          { language: 'css', label: 'CSS' },
                                          { language: 'html', label: 'HTML' },
                                          { language: 'xml', label: 'XML' },
                                          { language: 'JavaScript', label: 'JavaScript' }
                                    ]
                                  },
              //                    restrictedEditing: {
			         //                            allowedCommands: ['undo','redo' ],
			         //                            allowedAttributes: [ 'html' ] },
                      language: 'en'
                    } )
                    .catch( error => {
                        console.error( error );
                    } );
*/


</script>

<h1>Drag & Drop Example</h1>
  <main-dnd class="row-dnd">
    <div class="input-group-dnd">
      <div class="input-group-prepend">
        <span class="input-group-text">Enter new todo: </span>
      </div>
      <input
        type="text"
        class="form-control"
        placeholder="todo4"
        data-name="todo-input"
      />
      <div class="input-group-append">
        <button class="btn btn-success" data-name="add-btn">Add</button>
      </div>
    </div>
  <div class="col-4">
    <div class="input-group-dnd">
      <h4>JSON</h4>
      <ul class="list-group-dnd" data-name="in-progress-list">
        <li class="list-group-item-dnd" data-id="1" draggable="true">
          <p>todo1</p>
          <button
            class="btn btn-outline-danger btn-sm hidden"
            data-name="remove-btn"
          >
            X
          </button>
        </li>
        <li class="list-group-item-dnd" data-id="2" draggable="true">
          <p>todo2</p>
          <button
            class="btn btn-outline-danger btn-sm hidden"
            data-name="remove-btn"
          >
            X
          </button>
        </li>
      </ul>
    </div>

    <div class="input-group-dnd">
      <h4>EXCEL</h4>
      <ul class="list-group-dnd" data-name="completed-list">
        <li class="list-group-item-dnd" data-id="3" draggable="true">
          <p>MYSQL LOAD</p>
          <button
            class="btn btn-outline-danger btn-sm hidden"
            data-name="remove-btn"
          >
            X
          </button>
        </li>
      </ul>
    </div>
    <div class="input-group-dnd">
      <h4>File CSV</h4>
      <ul class="list-group-dnd" data-name="completed-list"></ul>
    </div>
    <div class="input-group-dnd">
      <h4>File OSM</h4>
      <ul class="list-group-dnd" data-name="completed-list">
        <li class="list-group-item-dnd" data-id="todo3" draggable="true">
          <p>todo3</p>
          <button
            class="btn btn-outline-danger btn-sm hidden"
            data-name="remove-btn"
          >
            X
          </button>
        </li>
      </ul>
    </div>
    <div class="input-group-dnd">
      <h4>Todos</h4>
      <ul class="list-maingroup-dnd" data-name="todos-list">
      </ul>
    </div>
  </div>
  </main-dnd>




<script type="text/javascript">

const main = document.querySelector("main-dnd");

main.addEventListener("click", (e) => {
  if (e.target.tagName === "BUTTON") {
    const { name } = e.target.dataset;
    if (name === "add-btn") {
      const todoInput = main.querySelector('[data-name="todo-input"]');
      if (todoInput.value.trim() !== "") {
        const value = todoInput.value;
        const template = `
        <li class="list-group-item-dnd" draggable="true" data-id="${Date.now()}">
          <p>${value}</p>
          <button class="btn btn-outline-danger btn-sm hidden" data-name="remove-btn">X</button>
        </li>
        `;
        const todosList = main.querySelector('[data-name="todos-list"]');
        todosList.insertAdjacentHTML("beforeend", template);
        todoInput.value = "";
      }
    } else if (name === "remove-btn") {
      e.target.parentElement.remove();
    }
  }
});

main.addEventListener("dragenter", (e) => {
  if (e.target.classList.contains("list-group-dnd")) {
    e.target.classList.add("drop");
  }
  if (e.target.classList.contains("list-maingroup-dnd")) {
    e.target.classList.add("drop");
  }
});

main.addEventListener("dragleave", (e) => {
  if (e.target.classList.contains("drop")) {
    e.target.classList.remove("drop");
  }
});

main.addEventListener("dragstart", (e) => {
  if (e.target.classList.contains("list-group-item-dnd")) {
    e.dataTransfer.setData("text/plain", e.target.dataset.id);
  }
});

let elemBelow = "";

main.addEventListener("dragover", (e) => {
  e.preventDefault();

  elemBelow = e.target;
});

main.addEventListener("drop", (e) => {
  const todo = main.querySelector(
    `[data-id="${e.dataTransfer.getData("text/plain")}"]`
  );

  if (elemBelow === todo) {
    return;
  }

  if (elemBelow.tagName === "P" || elemBelow.tagName === "BUTTON") {
    elemBelow = elemBelow.parentElement;
  }

  if (elemBelow.classList.contains("list-group-item-dnd")) {
    const center =
      elemBelow.getBoundingClientRect().y +
      elemBelow.getBoundingClientRect().height / 2;

    if (e.clientY > center) {
      if (elemBelow.nextElementSibling !== null) {
        elemBelow = elemBelow.nextElementSibling;
      } else {
        return;
      }
    }

    elemBelow.parentElement.insertBefore(todo, elemBelow);
    todo.className = elemBelow.className;
  }

  if (e.target.classList.contains("list-group-dnd") || e.target.classList.contains("list-maingroup-dnd")) {
    e.target.append(todo);

    if (e.target.classList.contains("drop")) {
      e.target.classList.remove("drop");
    }

    const { name } = e.target.dataset;

    if (name === "completed-list") {
      if (todo.classList.contains("in-progress")) {
        todo.classList.remove("in-progress");
      }
      todo.classList.add("completed");
    } else if (name === "in-progress-list") {
      if (todo.classList.contains("completed")) {
        todo.classList.remove("completed");
      }
      todo.classList.add("in-progress");
    } else {
      todo.className = "list-group-item-dnd";
    }
  }
});

</script>


</body>
</html>
